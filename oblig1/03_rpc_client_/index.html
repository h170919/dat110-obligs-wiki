
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../02_rpc_server_implementation__skeleton__/" rel="prev"/>
<link href="../04_rpc_server_/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.12" name="generator"/>
<title>Chapter 3: RPC Client - dat110 notes</title>
<link href="../../assets/stylesheets/main.2afb09e1.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-3-rpc-client">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="dat110 notes" class="md-header__button md-logo" data-md-component="logo" href="../.." title="dat110 notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            dat110 notes
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 3: RPC Client
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="dat110 notes" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="dat110 notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    dat110 notes
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Oblig1
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Oblig1
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01_rpc_client_stub_/">
<span class="md-ellipsis">
    Chapter 1: RPC Client Stub
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_rpc_server_implementation__skeleton__/">
<span class="md-ellipsis">
    Chapter 2: RPC Server Implementation (Skeleton)
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Chapter 3: RPC Client
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Chapter 3: RPC Client
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-the-problem-sending-the-message">
<span class="md-ellipsis">
      What's the Problem? Sending the Message!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-rpc-client-your-personal-network-courier">
<span class="md-ellipsis">
      The RPC Client: Your Personal Network Courier
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-the-stub-uses-the-rpc-client">
<span class="md-ellipsis">
      How the Stub Uses the RPC Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inside-the-rpc-client-connecting-and-calling">
<span class="md-ellipsis">
      Inside the RPC Client: Connecting and Calling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-flow-from-stub-to-server-and-back">
<span class="md-ellipsis">
      The Flow: From Stub to Server and Back
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_rpc_server_/">
<span class="md-ellipsis">
    Chapter 4: RPC Server
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_rpc_data_marshalling_unmarshalling_/">
<span class="md-ellipsis">
    Chapter 5: RPC Data Marshalling/Unmarshalling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_messaging_connection_/">
<span class="md-ellipsis">
    Chapter 6: Messaging Connection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_message_framing_protocol_/">
<span class="md-ellipsis">
    Chapter 7: Message Framing Protocol
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../oblig1_index/">
<span class="md-ellipsis">
    Project 1 Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Oblig2
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Oblig2
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/01_message_hierarchy__communication_protocol__/">
<span class="md-ellipsis">
    Chapter 1: Message Hierarchy (Communication Protocol)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/02_client__network_interaction_logic__/">
<span class="md-ellipsis">
    Chapter 2: Client (Network Interaction Logic)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/03_chapp__application_entry_point__/">
<span class="md-ellipsis">
    Chapter 3: Chapp (Application Entry Point)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/04_ui_areas__commandarea___messagearea__/">
<span class="md-ellipsis">
    Chapter 4: UI Areas (CommandArea &amp; MessageArea)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/05_controller__ui_logic_coordinator__/">
<span class="md-ellipsis">
    Chapter 5: Controller (UI Logic Coordinator)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/06_transportmessage__network_data_framing__/">
<span class="md-ellipsis">
    Chapter 6: TransportMessage (Network Data Framing)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/07_connection__network_stream_handling__/">
<span class="md-ellipsis">
    Chapter 7: Connection (Network Stream Handling)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/08_messageutils__serialization_deserialization__/">
<span class="md-ellipsis">
    Chapter 8: MessageUtils (Serialization/Deserialization)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/oblig2_index/">
<span class="md-ellipsis">
    Project 2 Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-the-problem-sending-the-message">
<span class="md-ellipsis">
      What's the Problem? Sending the Message!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-rpc-client-your-personal-network-courier">
<span class="md-ellipsis">
      The RPC Client: Your Personal Network Courier
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-the-stub-uses-the-rpc-client">
<span class="md-ellipsis">
      How the Stub Uses the RPC Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inside-the-rpc-client-connecting-and-calling">
<span class="md-ellipsis">
      Inside the RPC Client: Connecting and Calling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-flow-from-stub-to-server-and-back">
<span class="md-ellipsis">
      The Flow: From Stub to Server and Back
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="chapter-3-rpc-client">Chapter 3: RPC Client</h1>
<p>In the previous chapters, we met the <a href="../01_rpc_client_stub_/">RPC Client Stub</a> (like <code>SensorStub</code>), which acts as a local stand-in for a remote service, making remote function calls look easy like <code>sensor.read()</code>. We also saw the <a href="../02_rpc_server_implementation__skeleton__/">RPC Server Implementation (Skeleton)</a> (like <code>SensorImpl</code>), which contains the <em>actual</em> code on the server that performs the requested action.</p>
<p>But there's a missing piece! How does the request from the Stub <em>actually</em> travel across the network to reach the server, and how does the response get back? The Stub itself doesn't handle the nitty-gritty network details. It delegates this task to another component: the <strong>RPC Client</strong>.</p>
<h2 id="whats-the-problem-sending-the-message">What's the Problem? Sending the Message!</h2>
<p>Imagine our <code>SensorStub</code> wants to call the <code>read</code> method on the remote Sensor server. The Stub knows <em>what</em> to call (the <code>read</code> method, identified by <code>READ_RPCID</code>) and it prepares the "no parameters" message (<code>RPCUtils.marshallVoid()</code>). But how does it:</p>
<ol>
<li>Find the right server computer on the network?</li>
<li>Establish a reliable communication channel?</li>
<li>Send the request data (<code>READ_RPCID</code> + marshalled parameters)?</li>
<li>Wait patiently for the server to process the request and send back a result?</li>
<li>Receive the result data?</li>
</ol>
<p>This sounds like a lot of work involving network addresses, ports, sending/receiving bytes, and handling potential network issues. The Stub shouldn't worry about this; it just wants to make the call look simple.</p>
<h2 id="the-rpc-client-your-personal-network-courier">The RPC Client: Your Personal Network Courier</h2>
<p>This is where the <strong>RPC Client</strong> comes in. Think of it as a dedicated <strong>network courier service</strong> that the <a href="../01_rpc_client_stub_/">RPC Client Stub</a> uses.</p>
<ul>
<li><strong>The Stub (Customer):</strong> Decides what needs to be done remotely (e.g., "get temperature"). It prepares the order form (marshalled request: RPC ID + parameters).</li>
<li><strong>The RPC Client (Courier Service):</strong> Takes the order form from the Stub. It knows the address of the remote shop (RPC Server). It handles establishing the delivery route (network connection), sends the order form (request), waits for the shop to prepare the item, picks up the packaged item (marshalled response), and delivers it back to the Stub.</li>
<li><strong>The Network (Roads/Mail System):</strong> The underlying infrastructure used by the courier.</li>
<li><strong>The RPC Server (Remote Shop):</strong> Receives the order, processes it, and gives the result back to the courier.</li>
</ul>
<p>So, the <strong>RPC Client</strong> is:</p>
<ol>
<li><strong>A Connection Manager:</strong> It's responsible for connecting to a <em>specific</em> RPC Server at a known network address and port.</li>
<li><strong>A Request/Reply Handler:</strong> It provides a <code>call</code> method that takes the details from the Stub, sends them over the network, waits for the response, and returns it.</li>
<li><strong>A Messaging Layer User:</strong> It doesn't handle raw network sockets directly. Instead, it relies on the lower-level <a href="../06_messaging_connection_/">Messaging Connection</a> to do the actual sending and receiving of byte sequences.</li>
</ol>
<h2 id="how-the-stub-uses-the-rpc-client">How the Stub Uses the RPC Client</h2>
<p>Remember this line from <code>SensorStub.java</code>?</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// Inside SensorStub.read()</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="c1">// ... marshall parameters ...</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpcclient</span><span class="p">.</span><span class="na">call</span><span class="p">((</span><span class="kt">byte</span><span class="p">)</span><span class="n">Common</span><span class="p">.</span><span class="na">READ_RPCID</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">);</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1">// ... unmarshall response ...</span>
</span></code></pre></div>
<p>Here's what's happening:</p>
<ol>
<li>The <code>SensorStub</code> has an instance of <code>RPCClient</code> (named <code>rpcclient</code>) that was given to it when it was created. This <code>rpcclient</code> object is already configured to talk to the Sensor server.</li>
<li>The stub calls the <code>call</code> method on its <code>rpcclient</code> object.</li>
<li>It passes two things to <code>call</code>:<ul>
<li><code>Common.READ_RPCID</code>: The unique number identifying the remote <code>read</code> method.</li>
<li><code>request</code>: The marshalled parameters (in this case, the bytes representing "no parameters").</li>
</ul>
</li>
<li>The stub then <em>waits</em>. The <code>rpcclient.call()</code> method will not return until it gets a response back from the server.</li>
<li>When <code>rpcclient.call()</code> finally returns, it gives back the raw byte array (<code>response</code>) containing the marshalled result (the temperature) sent by the server.</li>
</ol>
<p>The <code>RPCClient</code> object handles all the communication steps in between.</p>
<h2 id="inside-the-rpc-client-connecting-and-calling">Inside the RPC Client: Connecting and Calling</h2>
<p>Let's peek inside <code>RPCClient.java</code> to see how it works.</p>
<p><strong>1. Connecting to the Server (<code>connect</code>)</strong></p>
<p>Before the Stub can make any calls, the <code>RPCClient</code> needs to establish a connection to the RPC Server. This usually happens once when the client application starts up.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/rpc/RPCClient.java (Simplified)</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">package</span><span class="w"> </span><span class="nn">no.hvl.dat110.rpc</span><span class="p">;</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">no.hvl.dat110.messaging.*</span><span class="p">;</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RPCClient</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="c1">// Holds the connection details and methods for sending/receiving messages</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MessagingClient</span><span class="w"> </span><span class="n">msgclient</span><span class="p">;</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MessageConnection</span><span class="w"> </span><span class="n">connection</span><span class="p">;</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="c1">// Constructor: remembers server address and port</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">RPCClient</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span><span class="c1">// Creates a client object from the messaging layer</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span><span class="n">msgclient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MessagingClient</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">);</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="c1">// Establishes the actual network connection</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">connect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">        </span><span class="c1">// Use the messaging client to connect and store the connection</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">        </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgclient</span><span class="p">.</span><span class="na">connect</span><span class="p">();</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">        </span><span class="c1">// Now we have an active link to the server!</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>
</span><span id="__span-1-25"><a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span><span class="c1">// ... call method is next ...</span>
</span><span id="__span-1-26"><a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a>
</span><span id="__span-1-27"><a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="c1">// Closes the network connection</span>
</span><span id="__span-1-28"><a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-29"><a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">        </span><span class="c1">// Close the underlying messaging connection</span>
</span><span id="__span-1-30"><a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connection</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-31"><a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">            </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</span><span id="__span-1-32"><a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-1-33"><a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-34"><a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>The constructor just stores the server's address (<code>server</code>, <code>port</code>) by creating a <code>MessagingClient</code> (from the <a href="../06_messaging_connection_/">Messaging Connection</a> layer).</li>
<li>The <code>connect()</code> method is the important part here. It calls <code>msgclient.connect()</code>. This tells the underlying messaging layer to actually create a network connection (like a TCP socket connection) to the specified server and port.</li>
<li>The established connection is stored in the <code>connection</code> variable. This <code>connection</code> object is what we'll use to send and receive messages.</li>
</ul>
<p><strong>2. Making the Remote Call (<code>call</code>)</strong></p>
<p>This is the core method used by the Stubs. It orchestrates the request-reply interaction.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/rpc/RPCClient.java (Simplified call method)</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RPCClient</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="c1">// ... constructor, connect, disconnect, connection variable ...</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">rpcid</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">        </span><span class="c1">// 1. Package the request: Combine RPC ID and parameters into</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="c1">//    a single byte array using a standard format.</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="c1">//    (See RPC Data Marshalling/Unmarshalling chapter for details)</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">requestData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RPCUtils</span><span class="p">.</span><span class="na">encapsulate</span><span class="p">(</span><span class="n">rpcid</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">);</span>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">        </span><span class="c1">// 2. Create a Message object (from the messaging layer)</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">        </span><span class="n">Message</span><span class="w"> </span><span class="n">requestMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Message</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">        </span><span class="c1">// 3. Send the message over the established connection</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">        </span><span class="n">connection</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">requestMessage</span><span class="p">);</span>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">        </span><span class="c1">// 4. Wait to receive the reply message from the server</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">        </span><span class="n">Message</span><span class="w"> </span><span class="n">replyMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">receive</span><span class="p">();</span>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">        </span><span class="c1">// 5. Unpack the reply: Extract the actual result bytes</span>
</span><span id="__span-2-23"><a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="c1">//    from the received message format.</span>
</span><span id="__span-2-24"><a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">        </span><span class="c1">//    (See RPC Data Marshalling/Unmarshalling chapter for details)</span>
</span><span id="__span-2-25"><a href="#__codelineno-2-25" id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">returnval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RPCUtils</span><span class="p">.</span><span class="na">decapsulate</span><span class="p">(</span><span class="n">replyMessage</span><span class="p">.</span><span class="na">getData</span><span class="p">());</span>
</span><span id="__span-2-26"><a href="#__codelineno-2-26" id="__codelineno-2-26" name="__codelineno-2-26"></a>
</span><span id="__span-2-27"><a href="#__codelineno-2-27" id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">        </span><span class="c1">// 6. Return the marshalled result bytes to the Stub</span>
</span><span id="__span-2-28"><a href="#__codelineno-2-28" id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">returnval</span><span class="p">;</span>
</span><span id="__span-2-29"><a href="#__codelineno-2-29" id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-30"><a href="#__codelineno-2-30" id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="p">}</span>
</span></code></pre></div>
<p>Let's break down the <code>call</code> method:</p>
<ol>
<li><strong>Encapsulate Request:</strong> It takes the <code>rpcid</code> (e.g., <code>READ_RPCID</code>) and the marshalled <code>params</code> (e.g., the "void" bytes) and combines them into a single byte array (<code>requestData</code>) using <code>RPCUtils.encapsulate</code>. This follows a specific format that the server will understand (we'll cover this format in <a href="../05_rpc_data_marshalling_unmarshalling_/">RPC Data Marshalling/Unmarshalling</a>).</li>
<li><strong>Create Message:</strong> It wraps the <code>requestData</code> into a <code>Message</code> object. This is required by the underlying <a href="../06_messaging_connection_/">Messaging Connection</a> layer.</li>
<li><strong>Send Message:</strong> It uses the <code>connection.send()</code> method (from the messaging layer) to transmit the <code>requestMessage</code> over the network to the server.</li>
<li><strong>Receive Reply:</strong> It calls <code>connection.receive()</code>. This method <em>blocks</em> â€“ it waits until data arrives back from the server on the same connection. When data arrives, <code>receive()</code> returns it as a <code>Message</code> object (<code>replyMessage</code>).</li>
<li><strong>Decapsulate Reply:</strong> It extracts the payload data from the <code>replyMessage</code> using <code>replyMessage.getData()</code> and then uses <code>RPCUtils.decapsulate</code> to remove the RPC protocol framing, leaving just the marshalled return value (<code>returnval</code>) sent by the server. (Again, see <a href="../05_rpc_data_marshalling_unmarshalling_/">RPC Data Marshalling/Unmarshalling</a>).</li>
<li><strong>Return Result:</strong> It returns the <code>returnval</code> (the raw bytes of the result) back to the calling code (the <code>SensorStub</code>).</li>
</ol>
<h2 id="the-flow-from-stub-to-server-and-back">The Flow: From Stub to Server and Back</h2>
<p>Here's a diagram showing the RPC Client's role in the communication:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Stub as SensorStub
    participant RPC_Client as RPCClient
    participant MsgConn as Messaging Connection
    participant Network
    participant RPC_Server as RPC Server (High Level)

    Stub-&gt;&gt;RPC_Client: call(READ_RPCID, void_params)
    Note over RPC_Client: Encapsulate(READ_RPCID, void_params) -&gt; request_bytes
    RPC_Client-&gt;&gt;MsgConn: send(new Message(request_bytes))
    Note over MsgConn: Send request_bytes over TCP socket
    MsgConn-&gt;&gt;Network: Send request data
    Network-&gt;&gt;RPC_Server: Request arrives
    Note over RPC_Server: Server processes request (unpacks, calls SensorImpl.invoke, gets result)
    Note over RPC_Server: Server encapsulates result -&gt; reply_bytes
    RPC_Server-&gt;&gt;Network: Send reply data (reply_bytes)
    Note over MsgConn: Receive reply_bytes via TCP socket
    Network-&gt;&gt;MsgConn: Receive reply data
    MsgConn--&gt;&gt;RPC_Client: return new Message(reply_bytes)
    Note over RPC_Client: Decapsulate(reply_bytes) -&gt; result_bytes (temp)
    RPC_Client--&gt;&gt;Stub: return result_bytes
end</code></pre>
<p>This shows the <code>RPCClient</code> acting as the middleman between the high-level <code>Stub</code> and the lower-level <code>Messaging Connection</code>. It packages the request, sends it, waits for the reply, and unpacks it.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The <strong>RPC Client</strong> is the engine that powers the client-side of our RPC system. It manages the network connection to a specific server and implements the core <code>call</code> method used by stubs. This <code>call</code> method handles the full cycle: packaging the request (encapsulation), sending it using the underlying <a href="../06_messaging_connection_/">Messaging Connection</a>, waiting for the reply, and unpacking the result (decapsulation). It effectively hides the complexities of network communication from the <a href="../01_rpc_client_stub_/">RPC Client Stub</a>, allowing the stub to focus on providing a simple, local-like interface for remote procedures.</p>
<p>Now that we understand how the client side sends requests and receives replies, we need to look at the server component that listens for these incoming connections and dispatches the requests to the correct <a href="02_rpc_server_implementation__skeleton_.md">RPC Server Implementation (Skeleton)</a>.</p>
<p>Next up: <a href="../04_rpc_server_/">RPC Server</a></p>
<hr/>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
</body>
</html>