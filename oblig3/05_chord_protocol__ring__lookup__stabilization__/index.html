
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../04_hashing___id_space_/" rel="prev"/>
<link href="../06_message_/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.12" name="generator"/>
<title>Chapter 5: Chord Protocol (Ring, Lookup, Stabilization) - dat110 notes</title>
<link href="../../assets/stylesheets/main.2afb09e1.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-5-chord-protocol-ring-lookup-stabilization">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="dat110 notes" class="md-header__button md-logo" data-md-component="logo" href="../.." title="dat110 notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            dat110 notes
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 5: Chord Protocol (Ring, Lookup, Stabilization)
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="dat110 notes" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="dat110 notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    dat110 notes
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Oblig1
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Oblig1
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/01_rpc_client_stub_/">
<span class="md-ellipsis">
    Chapter 1: RPC Client Stub
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/02_rpc_server_implementation__skeleton__/">
<span class="md-ellipsis">
    Chapter 2: RPC Server Implementation (Skeleton)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/03_rpc_client_/">
<span class="md-ellipsis">
    Chapter 3: RPC Client
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/04_rpc_server_/">
<span class="md-ellipsis">
    Chapter 4: RPC Server
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/05_rpc_data_marshalling_unmarshalling_/">
<span class="md-ellipsis">
    Chapter 5: RPC Data Marshalling/Unmarshalling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/06_messaging_connection_/">
<span class="md-ellipsis">
    Chapter 6: Messaging Connection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/07_message_framing_protocol_/">
<span class="md-ellipsis">
    Chapter 7: Message Framing Protocol
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig1/oblig1_index/">
<span class="md-ellipsis">
    Project 1 Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Oblig2
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Oblig2
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/01_message_hierarchy__communication_protocol__/">
<span class="md-ellipsis">
    Chapter 1: Message Hierarchy (Communication Protocol)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/02_client__network_interaction_logic__/">
<span class="md-ellipsis">
    Chapter 2: Client (Network Interaction Logic)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/03_chapp__application_entry_point__/">
<span class="md-ellipsis">
    Chapter 3: Chapp (Application Entry Point)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/04_ui_areas__commandarea___messagearea__/">
<span class="md-ellipsis">
    Chapter 4: UI Areas (CommandArea &amp; MessageArea)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/05_controller__ui_logic_coordinator__/">
<span class="md-ellipsis">
    Chapter 5: Controller (UI Logic Coordinator)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/06_transportmessage__network_data_framing__/">
<span class="md-ellipsis">
    Chapter 6: TransportMessage (Network Data Framing)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/07_connection__network_stream_handling__/">
<span class="md-ellipsis">
    Chapter 7: Connection (Network Stream Handling)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/08_messageutils__serialization_deserialization__/">
<span class="md-ellipsis">
    Chapter 8: MessageUtils (Serialization/Deserialization)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oblig2/oblig2_index/">
<span class="md-ellipsis">
    Project 2 Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Oblig3
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Oblig3
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01_file_management___replication_/">
<span class="md-ellipsis">
    Chapter 1: File Management &amp; Replication
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_node__peer__/">
<span class="md-ellipsis">
    Chapter 2: Node (Peer)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_remote_communication__rmi__/">
<span class="md-ellipsis">
    Chapter 3: Remote Communication (RMI)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_hashing___id_space_/">
<span class="md-ellipsis">
    Chapter 4: Hashing &amp; ID Space
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Chapter 5: Chord Protocol (Ring, Lookup, Stabilization)
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Chapter 5: Chord Protocol (Ring, Lookup, Stabilization)
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-problem-finding-who-has-what">
<span class="md-ellipsis">
      The Problem: Finding Who Has What
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-concepts-of-chord">
<span class="md-ellipsis">
      Key Concepts of Chord
    </span>
</a>
<nav aria-label="Key Concepts of Chord" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-the-ring-a-circle-of-nodes">
<span class="md-ellipsis">
      1. The Ring: A Circle of Nodes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-lookup-finding-the-responsible-node-findsuccessor">
<span class="md-ellipsis">
      2. Lookup: Finding the Responsible Node (findSuccessor)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-stabilization-keeping-the-ring-healthy">
<span class="md-ellipsis">
      3. Stabilization: Keeping the Ring Healthy
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-chord-in-our-project">
<span class="md-ellipsis">
      Using Chord in Our Project
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#under-the-hood-how-chord-finds-things">
<span class="md-ellipsis">
      Under the Hood: How Chord Finds Things
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_message_/">
<span class="md-ellipsis">
    Chapter 6: Message
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_consistency__remote_write_protocol__/">
<span class="md-ellipsis">
    Chapter 7: Consistency (Remote-Write Protocol)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08_distributed_mutual_exclusion_/">
<span class="md-ellipsis">
    Chapter 8: Distributed Mutual Exclusion
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../oblig3_index/">
<span class="md-ellipsis">
    Project 3 Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-problem-finding-who-has-what">
<span class="md-ellipsis">
      The Problem: Finding Who Has What
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-concepts-of-chord">
<span class="md-ellipsis">
      Key Concepts of Chord
    </span>
</a>
<nav aria-label="Key Concepts of Chord" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-the-ring-a-circle-of-nodes">
<span class="md-ellipsis">
      1. The Ring: A Circle of Nodes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-lookup-finding-the-responsible-node-findsuccessor">
<span class="md-ellipsis">
      2. Lookup: Finding the Responsible Node (findSuccessor)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-stabilization-keeping-the-ring-healthy">
<span class="md-ellipsis">
      3. Stabilization: Keeping the Ring Healthy
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-chord-in-our-project">
<span class="md-ellipsis">
      Using Chord in Our Project
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#under-the-hood-how-chord-finds-things">
<span class="md-ellipsis">
      Under the Hood: How Chord Finds Things
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="chapter-5-chord-protocol-ring-lookup-stabilization">Chapter 5: Chord Protocol (Ring, Lookup, Stabilization)</h1>
<p>Welcome to Chapter 5! In the <a href="../04_hashing___id_space_/">previous chapter</a>, we learned how <strong>Hashing &amp; ID Space</strong> provides a unique numerical address (ID) for every <a href="../02_node__peer__/">Node (Peer)</a> and file replica, placing them all within a vast, circular range of numbers.</p>
<p>Now, imagine our office building again. Every office has a unique room number (its ID from Chapter 4). But how do we know which office is next to which? How do we quickly find the office responsible for holding a specific document (using its file replica ID)? And what happens if a new office opens or an existing one closes down? We need a system to manage the building's layout, navigate it, and keep the directory up-to-date.</p>
<p>This chapter introduces the <strong>Chord Protocol</strong>. Think of Chord as the intelligent directory and navigation system for our distributed building. It defines:</p>
<ol>
<li><strong>Ring:</strong> How nodes organize themselves into a logical circle based on their IDs.</li>
<li><strong>Lookup:</strong> How any node can efficiently find the specific node responsible for a given ID (like a file replica ID).</li>
<li><strong>Stabilization:</strong> How the system handles nodes joining or leaving the network, keeping the ring structure correct over time.</li>
</ol>
<p><strong>What You'll Learn:</strong></p>
<ul>
<li>How nodes form a logical ring using their IDs.</li>
<li>How Chord finds the correct node for a specific ID (<code>findSuccessor</code>).</li>
<li>Why the ring needs to be maintained (<code>Stabilization</code>) and how it's done.</li>
<li>How finger tables help speed up lookups (basic idea).</li>
</ul>
<h2 id="the-problem-finding-who-has-what">The Problem: Finding Who Has What</h2>
<p>Let's revisit the core task from <a href="../01_file_management___replication_/">File Management &amp; Replication</a>. Suppose you want to store a file, and the <code>FileManager</code> calculates that replica "my_notes1" gets the ID <code>3375...677</code> (a huge number from Chapter 4). Which <a href="../02_node__peer__/">Node (Peer)</a> in the network should store this replica?</p>
<p>We can't just ask every single node â€“ that would be incredibly slow in a large network. We need an efficient way to look up the responsible node based on the replica's ID. This is the main problem Chord solves.</p>
<h2 id="key-concepts-of-chord">Key Concepts of Chord</h2>
<h3 id="1-the-ring-a-circle-of-nodes">1. The Ring: A Circle of Nodes</h3>
<p>Chord organizes nodes in a logical ring according to their numerical IDs (obtained via <a href="../04_hashing___id_space_/">Hashing &amp; ID Space</a>). Imagine placing the nodes on the giant circular ID space we discussed in Chapter 4.</p>
<ul>
<li>Each node connects to the node immediately following it in ID order. This next node is called its <strong>successor</strong>.</li>
<li>Each node also often keeps track of the node immediately preceding it, its <strong>predecessor</strong>.</li>
</ul>
<pre class="mermaid"><code>graph TD
    subgraph "Chord Ring (Simplified)"
        direction LR
        N8(Node ID=8) --&gt; N20(Node ID=20)
        N20 --&gt; N35(Node ID=35)
        N35 --&gt; N50(Node ID=50)
        N50 --&gt; N8
        subgraph Links
            N8 -- successor --&gt; N20
            N20 -- successor --&gt; N35
            N35 -- successor --&gt; N50
            N50 -- successor --&gt; N8
            N20 -- predecessor --&gt; N8
            N35 -- predecessor --&gt; N20
            N50 -- predecessor --&gt; N35
            N8 -- predecessor --&gt; N50
        end
    end</code></pre>
<p><em>Explanation:</em> Nodes (like N8, N20, etc.) are arranged in a circle based on their IDs. Each node knows its direct <code>successor</code> (the next one clockwise) and <code>predecessor</code> (the previous one counter-clockwise).</p>
<p><strong>Responsibility:</strong> A node is responsible for storing all the file replica IDs (<code>keys</code>) that fall between its predecessor's ID and its own ID. In the diagram, Node 35 would be responsible for keys with IDs like 21, 22, ..., up to 35. The successor node is always responsible for its own ID.</p>
<h3 id="2-lookup-finding-the-responsible-node-findsuccessor">2. Lookup: Finding the Responsible Node (<code>findSuccessor</code>)</h3>
<p>The core operation in Chord is <code>findSuccessor(key)</code>. Given a key (like a file replica ID), this function finds the <em>first</em> node in the ring whose ID is equal to or greater than the key (moving clockwise around the ring). This node is the one responsible for that key.</p>
<p><strong>How does it work (simplified)?</strong></p>
<ol>
<li><strong>Check Locally:</strong> A node first checks if the <code>key</code> falls between its own ID and its successor's ID. If yes, the successor is the answer!</li>
<li><strong>Ask Someone Else:</strong> If the key is not handled by the immediate successor, the node needs to ask another node further along the ring to continue the search.</li>
<li><strong>Forward the Request:</strong> The node intelligently chooses another node (usually using a "finger table" - see below) that is closer to the key and forwards the <code>findSuccessor(key)</code> request to that node. This process repeats until the responsible node is found.</li>
</ol>
<p><strong>Analogy:</strong> You're in Office 8 and need to find who handles file ID 42.
1.  You check your successor, Office 20. Is 42 between 8 and 20? No.
2.  You need to jump further. Instead of asking Office 20 (who would ask Office 35, etc.), you might have a shortcut in your directory (finger table) that says "For IDs around 40-50, try asking Office 35 directly."
3.  You call Office 35 and ask it: <code>findSuccessor(42)</code>.
4.  Office 35 checks its successor, Office 50. Is 42 between 35 and 50? Yes!
5.  Office 35 tells you (or the original requester) that Office 50 is responsible for ID 42.</p>
<p><strong>Finger Tables (The Shortcuts):</strong> Asking only the successor can be slow in a large ring. Each node maintains a "finger table," which is like a list of shortcuts. It contains pointers to nodes at exponentially increasing distances around the ring (e.g., the node 1 step away, 2 steps away, 4 steps away, 8 steps away, etc., in terms of ID distance). When doing a lookup, a node checks its finger table to find the farthest node it knows that is still <em>before</em> the target key. It then forwards the request to that node, significantly speeding up the search. Think of it as having express elevators in the building directory.</p>
<h3 id="3-stabilization-keeping-the-ring-healthy">3. Stabilization: Keeping the Ring Healthy</h3>
<p>Nodes can join and leave the network at any time. When this happens, the ring structure (successors, predecessors, finger tables) needs to be updated to reflect the changes. This process is called <strong>stabilization</strong>.</p>
<p>Nodes periodically run stabilization protocols:</p>
<ul>
<li><strong>Check Successor:</strong> A node asks its successor, "Who is your predecessor?". If the successor's predecessor is actually a node <em>between</em> the current node and the successor, that node should become the current node's new successor. (This handles nodes joining).</li>
<li><strong>Notify Successor:</strong> A node periodically tells its successor, "Hey, I exist, and I think you are my successor." This allows the successor to update its predecessor if needed.</li>
<li><strong>Check Predecessor:</strong> A node periodically checks if its predecessor is still responding (alive). If not, it sets its predecessor to <code>null</code>. (This handles nodes leaving abruptly).</li>
<li><strong>Fix Fingers:</strong> Nodes periodically recalculate their finger table entries to ensure the shortcuts point to the correct, live nodes.</li>
</ul>
<p><strong>Analogy:</strong> Stabilization is like the building management periodically:
*   Checking if the office listed next door is still the correct one or if a new office opened in between.
*   Reminding the office next door that you exist.
*   Checking if the office listed before yours is still occupied.
*   Updating the express elevator directory (finger table).</p>
<h2 id="using-chord-in-our-project">Using Chord in Our Project</h2>
<p>The <code>FileManager</code> (and Nodes themselves) rely heavily on Chord, primarily through the <code>findSuccessor</code> method implemented in <code>ChordLookup.java</code> and accessed via the <code>NodeInterface</code>.</p>
<p><strong>Scenario:</strong> <code>FileManager</code> needs to find where to store replica ID <code>key = 3375...677</code>. It runs on a node we'll call <code>currentNode</code>.</p>
<ol>
<li>
<p><strong>Initiate Lookup:</strong> The <code>FileManager</code> calls <code>findSuccessor(key)</code> on its <em>local</em> <code>currentNode</code> object.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// In FileManager, needing to find the node for replicaId</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">BigInteger</span><span class="w"> </span><span class="n">replicaId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hash</span><span class="p">.</span><span class="na">hashOf</span><span class="p">(</span><span class="s">"my_notes1"</span><span class="p">);</span><span class="w"> </span><span class="c1">// Get the ID</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">NodeInterface</span><span class="w"> </span><span class="n">currentNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// Get the Node object FileManager is running on</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="c1">// Ask the local node to find the node responsible for replicaId</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">responsibleNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentNode</span><span class="p">.</span><span class="na">findSuccessor</span><span class="p">(</span><span class="n">replicaId</span><span class="p">);</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">responsibleNode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Node responsible for ID "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">replicaId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" is: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">responsibleNode</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">());</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">        </span><span class="c1">// Now FileManager can use RMI to contact responsibleNode</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="c1">// e.g., responsibleNode.saveFileContent(...)</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Could not find responsible node for ID "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">replicaId</span><span class="p">);</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">"Error during Chord lookup: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em> The <code>FileManager</code>, using its associated <code>NodeInterface</code> (<code>currentNode</code>), calls the <code>findSuccessor</code> method with the target <code>replicaId</code>. Chord handles the potentially complex lookup process across the network transparently. The result (<code>responsibleNode</code>) is an RMI stub (<a href="03_remote_communication__rmi_.md">Chapter 3</a>) for the node that should manage this ID.</p>
</li>
<li>
<p><strong>Chord Does the Work:</strong> The <code>findSuccessor</code> implementation within <code>currentNode</code> (and potentially other nodes it contacts via RMI) executes the Chord lookup algorithm described earlier (checking successor, using finger tables, forwarding requests) until the correct node is identified.</p>
</li>
<li>
<p><strong>Result:</strong> The <code>findSuccessor</code> call returns a reference (<code>NodeInterface</code> stub) to the responsible node. The <code>FileManager</code> can then use this reference to interact with that node (e.g., to store or retrieve the file replica) using <a href="03_remote_communication__rmi_.md">Remote Communication (RMI)</a>.</p>
</li>
</ol>
<h2 id="under-the-hood-how-chord-finds-things">Under the Hood: How Chord Finds Things</h2>
<p>Let's look at the core <code>findSuccessor</code> logic in <code>ChordLookup.java</code>.</p>
<p><strong><code>findSuccessor(key)</code> Method:</strong></p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/chordoperations/ChordLookup.java (Simplified findSuccessor)</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kd">public</span><span class="w"> </span><span class="n">NodeInterface</span><span class="w"> </span><span class="nf">findSuccessor</span><span class="p">(</span><span class="n">BigInteger</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">RemoteException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="c1">// Get my own successor node</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">successor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="na">getSuccessor</span><span class="p">();</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">nodeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">succID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successor</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="c1">// 1. Is the key between me (exclusive) and my successor (inclusive)?</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="c1">// Util.checkInterval handles the wrap-around logic for the circular ID space</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Util</span><span class="p">.</span><span class="na">checkInterval</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">nodeID</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">),</span><span class="w"> </span><span class="n">succID</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">        </span><span class="c1">// Yes! My successor is responsible for the key.</span>
</span><span id="__span-1-14"><a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">successor</span><span class="p">;</span>
</span><span id="__span-1-15"><a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-16"><a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span><span class="c1">// 2. No. Need to ask someone closer to the key.</span>
</span><span id="__span-1-17"><a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">        </span><span class="c1">// Find the best node in my finger table to forward the request to.</span>
</span><span id="__span-1-18"><a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">        </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">highestPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findHighestPredecessor</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-1-19"><a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>
</span><span id="__span-1-20"><a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">        </span><span class="c1">// 3. Ask that node to continue the search.</span>
</span><span id="__span-1-21"><a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">        </span><span class="c1">// This is a recursive RMI call!</span>
</span><span id="__span-1-22"><a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">highestPred</span><span class="p">.</span><span class="na">findSuccessor</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-1-23"><a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-24"><a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em>
1.  It first checks if the <code>key</code> logically falls between its own <code>nodeID</code> and its direct <code>successor</code>'s ID (<code>succID</code>). The <code>Util.checkInterval</code> function correctly handles the circular nature of the ID space (where the successor might have a smaller ID than the current node if it wraps around past 0).
2.  If the successor is responsible, it's returned immediately.
3.  If not, it calls <code>findHighestPredecessor(key)</code> (explained below) to find the node in its finger table that is "closest" to the <code>key</code> without going past it.
4.  It then makes a <em>remote call</em> (using RMI) to that <code>highestPred</code> node, asking <em>it</em> to <code>findSuccessor(key)</code>. This forwards the search efficiently around the ring.</p>
<p><strong><code>findHighestPredecessor(key)</code> Method:</strong></p>
<p>This helper method searches the node's finger table to find the best shortcut.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/chordoperations/ChordLookup.java (Simplified findHighestPredecessor)</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kd">private</span><span class="w"> </span><span class="n">NodeInterface</span><span class="w"> </span><span class="nf">findHighestPredecessor</span><span class="p">(</span><span class="n">BigInteger</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">RemoteException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="c1">// Get my finger table (list of shortcuts)</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">NodeInterface</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fingers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="na">getFingerTable</span><span class="p">();</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">nodeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="c1">// Iterate backwards through the finger table (from farthest to closest shortcut)</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fingers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">fingerNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fingers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fingerNode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">            </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">fingerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fingerNode</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">            </span><span class="c1">// Check if this finger node is between me and the key (exclusive)</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Util</span><span class="p">.</span><span class="na">checkInterval</span><span class="p">(</span><span class="n">fingerID</span><span class="p">,</span><span class="w"> </span><span class="n">nodeID</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">),</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">                </span><span class="c1">// Found the best shortcut! Return this node.</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">fingerNode</span><span class="p">;</span>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="c1">// If no finger is better than myself, return myself.</span>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="c1">// 'node' refers to the current Node object</span>
</span><span id="__span-2-23"><a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em> It looks through the finger table entries (<code>fingers</code>) from the end (longest jump) to the beginning (shortest jump - the successor). It returns the first finger node it finds whose ID is strictly between the current node's ID and the target <code>key</code>. This ensures we make the biggest possible jump towards the key without overshooting it. If no suitable finger is found, it means the current node itself is the closest predecessor, so it returns <code>node</code>.</p>
<p><strong>Sequence Diagram: <code>findSuccessor(42)</code> (Example)</strong></p>
<p>Imagine Node 8 initiates <code>findSuccessor(42)</code>. Let's say its finger table points to Node 35 as a shortcut for IDs in that range.</p>
<pre class="mermaid"><code>sequenceDiagram
    participant N8 as Node 8
    participant N35 as Node 35 (Finger)
    participant N50 as Node 50 (Successor of N35)

    N8-&gt;&gt;N8: findSuccessor(42)
    N8-&gt;&gt;N8: checkInterval(42, 8+1, 20)? --&gt; false
    N8-&gt;&gt;N8: findHighestPredecessor(42) --&gt; N35 (from finger table)
    N8-&gt;&gt;N35: findSuccessor(42) via RMI
    N35-&gt;&gt;N35: checkInterval(42, 35+1, 50)? --&gt; true
    N35--&gt;&gt;N8: N50 (result)
    N8--&gt;&gt;N8: return N50</code></pre>
<p><em>Explanation:</em> Node 8 checks its successor (N20), fails. Finds N35 in its finger table as the highest predecessor for 42. It remotely calls <code>findSuccessor(42)</code> on N35. N35 checks <em>its</em> successor (N50). Since 42 is between 35 and 50, N35 returns N50 as the result back to N8.</p>
<p><strong>Stabilization Logic:</strong></p>
<p>The stabilization code (<code>StabilizationProtocols.java</code>) runs periodically in the background:</p>
<ul>
<li><code>stabilizeRing()</code>: Asks successor (<code>succ</code>) for its predecessor (<code>predsucc</code>). If <code>predsucc</code> has an ID between <code>nodeID</code> and <code>succID</code>, it means <code>predsucc</code> just joined and should be the new successor. The current node updates its successor to <code>predsucc</code> and notifies <code>predsucc</code>.</li>
<li><code>notify(potential_pred)</code>: Called remotely on a node (e.g., <code>succ</code>) by another node (<code>potential_pred</code>) claiming to be its predecessor. The receiving node (<code>succ</code>) checks if <code>potential_pred</code>'s ID is between its current predecessor's ID and its own ID. If yes, it updates its predecessor to <code>potential_pred</code>.</li>
<li><code>checkPredecessor()</code>: Pings the current predecessor using RMI (<code>Util.getProcessStub</code>). If the RMI call fails (returns null or throws exception), it means the predecessor is gone, so the node sets its predecessor reference to <code>null</code>.</li>
<li><code>fixFingerTable()</code>: Periodically recalculates all finger table entries. For each entry <code>i</code>, it computes <code>start = (nodeID + 2^i) mod addressSize</code> and calls <code>findSuccessor(start)</code> to find the node responsible for that ID, updating the <code>i</code>-th finger.</li>
</ul>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/chordoperations/StabilizationProtocols.java (Simplified stabilizeRing logic)</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stabilizeRing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">        </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">succ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chordnode</span><span class="p">.</span><span class="na">getSuccessor</span><span class="p">();</span><span class="w"> </span><span class="c1">// My successor</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">        </span><span class="n">NodeInterface</span><span class="w"> </span><span class="n">pred_of_succ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">succ</span><span class="p">.</span><span class="na">getPredecessor</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ask successor for its predecessor (RMI call)</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pred_of_succ</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">            </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">nodeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chordnode</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">            </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">succID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">succ</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">            </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">pred_of_succ_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred_of_succ</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">();</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">            </span><span class="c1">// Is pred_of_succ between me and my successor?</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="na">checkInterval</span><span class="p">(</span><span class="n">pred_of_succ_ID</span><span class="p">,</span><span class="w"> </span><span class="n">nodeID</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">),</span><span class="w"> </span><span class="n">succID</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">));</span>
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-17"><a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">                </span><span class="c1">// Yes, pred_of_succ should be my new successor</span>
</span><span id="__span-3-18"><a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">                </span><span class="n">chordnode</span><span class="p">.</span><span class="na">setSuccessor</span><span class="p">(</span><span class="n">pred_of_succ</span><span class="p">);</span>
</span><span id="__span-3-19"><a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-3-20"><a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-21"><a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">        </span><span class="c1">// Always notify my current successor that I exist</span>
</span><span id="__span-3-22"><a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">        </span><span class="c1">// (This allows the successor to update its predecessor if needed)</span>
</span><span id="__span-3-23"><a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">        </span><span class="n">chordnode</span><span class="p">.</span><span class="na">getSuccessor</span><span class="p">().</span><span class="na">notify</span><span class="p">(</span><span class="n">chordnode</span><span class="p">);</span>
</span><span id="__span-3-24"><a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>
</span><span id="__span-3-25"><a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... handle error ... */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-26"><a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em> This snippet shows the core check. If a node (<code>pred_of_succ</code>) exists between the current node (<code>chordnode</code>) and its successor (<code>succ</code>), <code>chordnode</code> adopts <code>pred_of_succ</code> as its new direct successor. It then always notifies its (potentially updated) successor.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this chapter, we explored the <strong>Chord Protocol</strong>, the backbone of our distributed system's organization. We learned how nodes use their unique IDs (<a href="../04_hashing___id_space_/">Hashing &amp; ID Space</a>) to form a logical <strong>Ring</strong>. We saw how the crucial <strong>Lookup</strong> operation (<code>findSuccessor</code>) efficiently finds the node responsible for any given ID, using successor pointers and finger table shortcuts. Finally, we understood the importance of <strong>Stabilization</strong> protocols, which keep the ring structure accurate even when nodes join or leave, ensuring the system remains robust and navigable. Chord provides the essential directory and navigation services for our distributed office building.</p>
<p>Now that we know how nodes are organized and how they find each other, let's look closer at what they actually pass around when communicating. In the next chapter, we'll examine the <a href="../06_message_/">Message</a> structure, which is used not only for communication requests but also for storing the metadata about the file replicas managed by each node.</p>
<hr/>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
</body>
</html>