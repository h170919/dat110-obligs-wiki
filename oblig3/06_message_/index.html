
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../05_chord_protocol__ring__lookup__stabilization__/">
      
      
        <link rel="next" href="../07_consistency__remote_write_protocol__/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Chapter 6: Message - dat110 notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-6-message" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="dat110 notes" class="md-header__button md-logo" aria-label="dat110 notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dat110 notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 6: Message
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="dat110 notes" class="md-nav__button md-logo" aria-label="dat110 notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dat110 notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Oblig1
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Oblig1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/01_rpc_client_stub_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: RPC Client Stub
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/02_rpc_server_implementation__skeleton__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: RPC Server Implementation (Skeleton)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/03_rpc_client_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: RPC Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/04_rpc_server_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: RPC Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/05_rpc_data_marshalling_unmarshalling_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: RPC Data Marshalling/Unmarshalling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/06_messaging_connection_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: Messaging Connection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/07_message_framing_protocol_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: Message Framing Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig1/oblig1_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 1 Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Oblig2
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Oblig2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/00_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial: dat110-oblig2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/01_client_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/02_broker_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: Broker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/03_message_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: Message
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/04_messagetype_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: MessageType
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/05_messageutils_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: MessageUtils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/06_connection_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: Connection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/07_dispatcher_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: Dispatcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/08_storage_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8: Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/09_clientsession_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9: ClientSession
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oblig2/10_stopable_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 10: Stopable
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Oblig3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Oblig3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_file_management___replication_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: File Management &amp; Replication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_node__peer__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: Node (Peer)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_remote_communication__rmi__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: Remote Communication (RMI)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_hashing___id_space_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: Hashing &amp; ID Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_chord_protocol__ring__lookup__stabilization__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: Chord Protocol (Ring, Lookup, Stabilization)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 6: Message
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: Message
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-standardized-memo-analogy" class="md-nav__link">
    <span class="md-ellipsis">
      The Standardized Memo Analogy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-information-in-a-message" class="md-nav__link">
    <span class="md-ellipsis">
      Key Information in a Message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-message-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Using Message Objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#under-the-hood-the-messagejava-class" class="md-nav__link">
    <span class="md-ellipsis">
      Under the Hood: The Message.java Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_consistency__remote_write_protocol__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: Consistency (Remote-Write Protocol)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_distributed_mutual_exclusion_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8: Distributed Mutual Exclusion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oblig3_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project 3 Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-standardized-memo-analogy" class="md-nav__link">
    <span class="md-ellipsis">
      The Standardized Memo Analogy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-information-in-a-message" class="md-nav__link">
    <span class="md-ellipsis">
      Key Information in a Message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-message-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Using Message Objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#under-the-hood-the-messagejava-class" class="md-nav__link">
    <span class="md-ellipsis">
      Under the Hood: The Message.java Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-6-message">Chapter 6: Message</h1>
<p>Welcome to Chapter 6! In the <a href="05_chord_protocol__ring__lookup__stabilization_.md">previous chapter</a>, we learned how the <strong>Chord Protocol</strong> acts like a clever directory and navigation system, allowing nodes to organize themselves into a ring and efficiently find the node responsible for any given piece of data using its ID.</p>
<p>Now, imagine Node A has used Chord to find that Node B is responsible for storing a replica of "my_notes.txt". Node A needs to send a request to Node B using <a href="../03_remote_communication__rmi__/">Remote Communication (RMI)</a>. But what exactly should Node A send? It needs to include the file name, the replica ID, the actual file data, maybe who sent the request, and perhaps some special instructions. Just sending raw bits of data isn't organized. We need a standard format for these communications.</p>
<p>This chapter introduces the <strong>Message</strong> concept. It's a standardized data structure, like a pre-printed form or memo, used to package information neatly when nodes exchange data or requests.</p>
<p><strong>What You'll Learn:</strong></p>
<ul>
<li>Why a standardized <code>Message</code> format is useful for communication.</li>
<li>What key pieces of information are included in a <code>Message</code>.</li>
<li>How <code>Message</code> objects are created and used in the system.</li>
<li>How <code>Message</code> objects are also used to store file metadata on <a href="../02_node__peer__/">Nodes (Peers)</a>.</li>
</ul>
<h2 id="the-standardized-memo-analogy">The Standardized Memo Analogy</h2>
<p>Think of inter-office communication in a large company. If everyone just scribbled notes on random pieces of paper, it would be chaos! Important details might be missed, and processing requests would be slow. Instead, companies often use standardized memo forms.</p>
<p>A typical memo form might have fields for:</p>
<ul>
<li><strong>FROM:</strong> (Sender's Name/Department)</li>
<li><strong>TO:</strong> (Recipient's Name/Department - <em>Implied by delivery</em>)</li>
<li><strong>DATE:</strong> (When it was sent)</li>
<li><strong>SUBJECT:</strong> (What is this memo about?)</li>
<li><strong>BODY:</strong> (The actual content or request)</li>
<li><strong>ATTACHMENTS:</strong> (Any accompanying documents)</li>
<li><strong>URGENT?</strong> (Checkbox for priority)</li>
<li><strong>ACTION REQUIRED?</strong> (Checkbox for status)</li>
</ul>
<p>Our <code>Message</code> class is exactly like this standardized memo for our distributed system nodes. It ensures that whenever nodes communicate or store information about files, all the necessary details are present in a predictable format.</p>
<h2 id="key-information-in-a-message">Key Information in a <code>Message</code></h2>
<p>Let's look at the important fields inside our <code>Message</code> "memo":</p>
<ol>
<li>
<p><strong>Sender Information:</strong></p>
<ul>
<li><code>nodeID</code> (<a href="../04_hashing___id_space_/">BigInteger</a>): The unique ID of the node sending or associated with this message. (Like the sender's official employee ID).</li>
<li><code>nodename</code> (String): The human-readable name of the sender node (e.g., "process1").</li>
<li><code>port</code> (int): The communication port of the sender node.</li>
</ul>
</li>
<li>
<p><strong>File Information (if applicable):</strong></p>
<ul>
<li><code>nameOfFile</code> (String): The original name of the file this message relates to (e.g., "my_notes"). (Like the "SUBJECT" line).</li>
<li><code>hashOfFile</code> (<a href="../04_hashing___id_space_/">BigInteger</a>): The specific ID of the file replica this message is about (e.g., the hash of "my_notes1").</li>
<li><code>bytesOfFile</code> (<code>byte[]</code>): The actual content of the file replica. (Like the "ATTACHMENTS"). This isn't always filled, only when sending the file data itself.</li>
<li><code>filepath</code> (String): Sometimes used to store the original path of the file, though less critical for internal node communication.</li>
</ul>
</li>
<li>
<p><strong>Ordering &amp; Status:</strong></p>
<ul>
<li><code>clock</code> (int): A Lamport clock timestamp. This is a simple counter used to help determine the order of events across different nodes, which is important for things like <a href="07_consistency__remote_write_protocol_.md">Consistency (Remote-Write Protocol)</a>. (Like a sequence number on the memo).</li>
<li><code>acknowledged</code> (boolean): A flag to indicate if this message has been acknowledged or processed. (Like a "RECEIVED" stamp).</li>
<li><code>primaryServer</code> (boolean): A special flag indicating if the node holding this file replica is the "primary" copy. This is crucial for coordinating updates, as we'll see in the <a href="07_consistency__remote_write_protocol_.md">Consistency (Remote-Write Protocol)</a> chapter. (Like an "ACTION REQUIRED BY:" checkbox).</li>
</ul>
</li>
</ol>
<h2 id="using-message-objects">Using <code>Message</code> Objects</h2>
<p><code>Message</code> objects are used in two primary ways:</p>
<p><strong>1. Packaging Information for RMI Calls:</strong></p>
<p>When one node needs to send data to another using <a href="../03_remote_communication__rmi__/">Remote Communication (RMI)</a>, it often packages the necessary information into a <code>Message</code> object.</p>
<p><strong>Example:</strong> Node A (running <code>FileManager</code>) wants to tell Node B to save a file replica.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">// --- On Node A (inside FileManager or similar) ---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">NodeInterface</span><span class="w"> </span><span class="n">nodeB_stub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="na">getProcessStub</span><span class="p">(</span><span class="s">&quot;process2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9092</span><span class="p">);</span><span class="w"> </span><span class="c1">// Get RMI stub for Node B</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">// Details of the replica to be saved</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my_notes&quot;</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">BigInteger</span><span class="w"> </span><span class="n">replicaId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hash</span><span class="p">.</span><span class="na">hashOf</span><span class="p">(</span><span class="s">&quot;my_notes1&quot;</span><span class="p">);</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">//... read file content ...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kt">boolean</span><span class="w"> </span><span class="n">isPrimary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assume this is not the primary replica</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1">// Create a Message object to package the info</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">Message</span><span class="w"> </span><span class="n">fileInfoMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Message</span><span class="p">(</span><span class="n">nodeA</span><span class="p">.</span><span class="na">getNodeID</span><span class="p">(),</span><span class="w"> </span><span class="n">nodeA</span><span class="p">.</span><span class="na">getNodeName</span><span class="p">(),</span><span class="w"> </span><span class="n">nodeA</span><span class="p">.</span><span class="na">getPort</span><span class="p">());</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">setNameOfFile</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">setHashOfFile</span><span class="p">(</span><span class="n">replicaId</span><span class="p">);</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">setBytesOfFile</span><span class="p">(</span><span class="n">fileContent</span><span class="p">);</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">setPrimaryServer</span><span class="p">(</span><span class="n">isPrimary</span><span class="p">);</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1">// fileInfoMsg.setClock(...); // Lamport clock would be set here too</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="c1">// Send the entire Message object via RMI</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="c1">// (Note: In the actual project, RMI methods might take individual parameters</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="c1">// derived from the Message, or the Message itself might be adapted/wrapped)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="c1">// Example hypothetical RMI call:</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="c1">// nodeB_stub.receiveAndStoreFile(fileInfoMsg);</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">    </span><span class="c1">// OR, more likely based on current NodeInterface:</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">    </span><span class="n">nodeB_stub</span><span class="p">.</span><span class="na">saveFileContent</span><span class="p">(</span><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">getNameOfFile</span><span class="p">(),</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">                               </span><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">getHashOfFile</span><span class="p">(),</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">                               </span><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">getBytesOfFile</span><span class="p">(),</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">                               </span><span class="n">fileInfoMsg</span><span class="p">.</span><span class="na">isPrimaryServer</span><span class="p">());</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Sent file info for &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; to Node B.&quot;</span><span class="p">);</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Error sending file info: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em> Node A gathers all the necessary details about the file replica (<code>filename</code>, <code>replicaId</code>, <code>fileContent</code>, <code>isPrimary</code>, plus sender info). It creates a <code>Message</code> object and uses setter methods (like <code>setNameOfFile</code>, <code>setBytesOfFile</code>) to populate it. This organized <code>Message</code> (or the information extracted from it) is then sent over the network using RMI to Node B.</p>
<p><strong>2. Storing File Metadata on Nodes:</strong></p>
<p>As mentioned in the <a href="../02_node__peer__/">Node (Peer)</a> chapter, each node maintains a <code>filesMetadata</code> map:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">// Inside Node.java</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filesMetadata</span><span class="p">;</span><span class="w"> </span><span class="c1">// Stores info about files this node holds</span>
</span></code></pre></div>
<p>This map uses the file replica ID (<code>BigInteger</code>) as the key. The <em>value</em> stored for each key is a <code>Message</code> object! This <code>Message</code> object holds all the relevant metadata about that specific file replica stored on <em>this</em> node (like its original name, its replica ID, whether it's the primary, its Lamport clock value, etc.). It typically <em>doesn't</em> store the <code>bytesOfFile</code> in this map to save memory; the actual file content might be stored separately on disk, referenced by the metadata.</p>
<p><strong>Example:</strong> When Node B receives the <code>saveFileContent</code> call from Node A.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// --- On Node B (inside Node.java&#39;s saveFileContent method) ---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nd">@Override</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveFileContent</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">fileID</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytesOfFile</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">primary</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">RemoteException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Node &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nodename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: Received request to save &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; (ID: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">);</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="c1">// Create a Message object to store the *metadata* for this replica</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="c1">// Use info about *this* node (Node B) as the &#39;sender&#39; in the metadata context</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="n">Message</span><span class="w"> </span><span class="n">metaData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Message</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">nodeID</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">nodename</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">port</span><span class="p">);</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="n">metaData</span><span class="p">.</span><span class="na">setNameOfFile</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="n">metaData</span><span class="p">.</span><span class="na">setHashOfFile</span><span class="p">(</span><span class="n">fileID</span><span class="p">);</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="c1">// metaData.setBytesOfFile(null); // Don&#39;t store bytes in the metadata map</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">metaData</span><span class="p">.</span><span class="na">setPrimaryServer</span><span class="p">(</span><span class="n">primary</span><span class="p">);</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="c1">// metaData.setClock(0); // Initialize clock</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="c1">// Store the metadata Message in the map, keyed by the replica ID</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="n">filesMetadata</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">fileID</span><span class="p">,</span><span class="w"> </span><span class="n">metaData</span><span class="p">);</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="c1">// Store the actual file content (bytesOfFile) somewhere else, e.g., on disk</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="c1">// storeBytesToFileSystem(fileID, bytesOfFile); // Hypothetical method</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Node &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nodename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: Stored metadata for &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em> When Node B is asked to save a file replica, it creates a <em>new</em> <code>Message</code> object to represent the <em>metadata</em> it needs to remember about this replica. It populates this <code>Message</code> with the provided details (<code>filename</code>, <code>fileID</code>, <code>primary</code> status) and information about itself (<code>nodeID</code>, <code>nodename</code>, <code>port</code>). This metadata <code>Message</code> is then stored in the <code>filesMetadata</code> map. This allows Node B to later answer questions like "What files are you storing?" or "Are you the primary for file replica X?".</p>
<h2 id="under-the-hood-the-messagejava-class">Under the Hood: The <code>Message.java</code> Class</h2>
<p>The <code>Message</code> class itself is relatively simple. It's primarily a container for data.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// File: src/main/java/no/hvl/dat110/middleware/Message.java (Simplified)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">package</span><span class="w"> </span><span class="nn">no.hvl.dat110.middleware</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span><span class="w"> </span><span class="c1">// Important!</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigInteger</span><span class="p">;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.RemoteException</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1">// Message must implement Serializable to be sent via RMI</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Message</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="c1">// Unique ID for serialization compatibility</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="c1">// Fields we discussed:</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">             </span><span class="c1">// Lamport clock</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">nodeID</span><span class="p">;</span><span class="w">         </span><span class="c1">// Sender/Owner Node ID</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nodename</span><span class="p">;</span><span class="w">           </span><span class="c1">// Sender/Owner Node Name</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span><span class="w">                  </span><span class="c1">// Sender/Owner Node Port</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">acknowledged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Acknowledgment status</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">filepath</span><span class="p">;</span><span class="w">           </span><span class="c1">// Original file path (optional)</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytesOfFile</span><span class="p">;</span><span class="w">        </span><span class="c1">// File content (used for transfer)</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">hashOfFile</span><span class="p">;</span><span class="w">     </span><span class="c1">// File replica ID</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nameOfFile</span><span class="p">;</span><span class="w">         </span><span class="c1">// Original file name</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">primaryServer</span><span class="p">;</span><span class="w">     </span><span class="c1">// Is this the primary replica?</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">    </span><span class="c1">// Constructor to set basic node info</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Message</span><span class="p">(</span><span class="n">BigInteger</span><span class="w"> </span><span class="n">nodeID</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nodename</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nodeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeID</span><span class="p">;</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nodename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodename</span><span class="p">;</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">port</span><span class="p">;</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">    </span><span class="c1">// --- Getters and Setters for all fields ---</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">    </span><span class="c1">// Example:</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getNameOfFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nameOfFile</span><span class="p">;</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setNameOfFile</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nameOfFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nameOfFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nameOfFile</span><span class="p">;</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="w">    </span><span class="c1">// ... other getters and setters ...</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="p">}</span>
</span></code></pre></div>
<p><em>Explanation:</em>
*   <strong><code>implements Serializable</code>:</strong> This is crucial. It's a marker interface from Java that tells the Java runtime environment that objects of this class are allowed to be "flattened" into a sequence of bytes (serialized) and sent over a network stream (like RMI does) or saved to a file. The receiving end can then reconstruct the original object from these bytes (deserialize). Without <code>Serializable</code>, RMI wouldn't be able to transmit <code>Message</code> objects.
*   <strong><code>serialVersionUID</code>:</strong> This is a version number used during serialization/deserialization to ensure the sender and receiver are using compatible versions of the <code>Message</code> class.
*   <strong>Fields:</strong> It contains private fields for all the pieces of information we discussed (sender, file, status).
*   <strong>Constructor:</strong> A simple constructor to initialize the basic node information.
*   <strong>Getters and Setters:</strong> Standard methods (<code>getFieldName()</code>, <code>setFieldName(value)</code>) are provided to access and modify the private fields, following standard Java practice for data classes (JavaBeans).</p>
<p>There's no complex logic inside the <code>Message</code> class itself; it's just a well-defined container, our standardized memo format.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this chapter, we learned about the <code>Message</code> class, which acts as a standardized information package – like a memo – for our distributed system. It bundles together crucial details about the sender, the file involved, status flags, and ordering information.</p>
<p>We saw how <code>Message</code> objects are essential for packaging data sent between nodes using <a href="03_remote_communication__rmi_.md">Remote Communication (RMI)</a> and how they are also used by each <a href="../02_node__peer__/">Node (Peer)</a> to store the metadata (<code>filesMetadata</code>) about the file replicas it manages. Using this standard format makes communication and data management much more organized and reliable.</p>
<p>Now that we have nodes organized (<a href="05_chord_protocol__ring__lookup__stabilization_.md">Chord Protocol (Ring, Lookup, Stabilization)</a>) and a standard way to package information (<code>Message</code>), a critical question arises: if we have multiple copies (replicas) of a file stored on different nodes, how do we ensure they all stay consistent when the file is updated? We'll tackle this challenge in the next chapter on <a href="07_consistency__remote_write_protocol_.md">Consistency (Remote-Write Protocol)</a>.</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>