
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../04_ui_areas__commandarea___messagearea__/">
      
      
        <link rel="next" href="../06_transportmessage__network_data_framing__/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Chapter 5: Controller (UI Logic Coordinator) - dat110 notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-5-controller-ui-logic-coordinator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dat110 notes" class="md-header__button md-logo" aria-label="dat110 notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dat110 notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 5: Controller (UI Logic Coordinator)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dat110 notes" class="md-nav__button md-logo" aria-label="dat110 notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dat110 notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial: dat110-project2-javafx-chatapp
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_message_hierarchy__communication_protocol__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: Message Hierarchy (Communication Protocol)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_client__network_interaction_logic__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: Client (Network Interaction Logic)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_chapp__application_entry_point__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: Chapp (Application Entry Point)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_ui_areas__commandarea___messagearea__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: UI Areas (CommandArea &amp; MessageArea)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 5: Controller (UI Logic Coordinator)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: Controller (UI Logic Coordinator)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-director-of-the-play-introducing-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      The Director of the Play: Introducing the Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-the-controller-gets-involved-a-button-click-example" class="md-nav__link">
    <span class="md-ellipsis">
      How the Controller Gets Involved: A Button Click Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-happens-inside-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      What Happens Inside the Controller?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-look-at-the-controllers-code" class="md-nav__link">
    <span class="md-ellipsis">
      A Look at the Controller's Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-central-hub" class="md-nav__link">
    <span class="md-ellipsis">
      The Central Hub
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_transportmessage__network_data_framing__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: TransportMessage (Network Data Framing)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_connection__network_stream_handling__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: Connection (Network Stream Handling)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_messageutils__serialization_deserialization__/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8: MessageUtils (Serialization/Deserialization)
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-director-of-the-play-introducing-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      The Director of the Play: Introducing the Controller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-the-controller-gets-involved-a-button-click-example" class="md-nav__link">
    <span class="md-ellipsis">
      How the Controller Gets Involved: A Button Click Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-happens-inside-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      What Happens Inside the Controller?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-look-at-the-controllers-code" class="md-nav__link">
    <span class="md-ellipsis">
      A Look at the Controller's Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-central-hub" class="md-nav__link">
    <span class="md-ellipsis">
      The Central Hub
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-5-controller-ui-logic-coordinator">Chapter 5: Controller (UI Logic Coordinator)</h1>
<p>In the <a href="../04_ui_areas__commandarea___messagearea__/">previous chapter</a>, we explored the <code>CommandArea</code> (where you type commands) and the <code>MessageArea</code> (where you see messages). We saw that when you click a button in the <code>CommandArea</code>, it needs to tell <em>something</em> to perform the actual action, like connecting to the server or sending a message. Similarly, when a new message arrives from the network, <em>something</em> needs to take that message and display it in the <code>MessageArea</code>.</p>
<p>But who is this "something"? The <code>CommandArea</code> shouldn't know the details of network connections, and the <code>MessageArea</code> shouldn't be responsible for listening for incoming data. We need a central coordinator to manage the flow of information between the user interface and the background logic.</p>
<h2 id="the-director-of-the-play-introducing-the-controller">The Director of the Play: Introducing the Controller</h2>
<p>Imagine our chat application is like a stage play:
*   The <strong>User Interface</strong> (<code>CommandArea</code>, <code>MessageArea</code>) are the actors on stage.
*   The <strong>User</strong> is the audience member giving cues (clicking buttons).
*   The <strong>Client</strong> (<a href="../02_client__network_interaction_logic__/">Chapter 2</a>) is like the backstage crew handling technical things (network communication).
*   The <strong>Message Protocol</strong> (<a href="../01_message_hierarchy__communication_protocol__/">Chapter 1</a>) is the script they follow.</p>
<p>Who tells the actors what to do based on the cues, and who tells the backstage crew when to perform their tasks? That's the <strong>Director</strong>!</p>
<p>In our application, the <code>Controller</code> class (<code>Controller.java</code>) acts as this director. It's the <strong>UI Logic Coordinator</strong>. It sits between the UI elements and the <code>Client</code> logic, directing the flow of actions and information.</p>
<p><strong>Its main jobs are:</strong></p>
<ol>
<li><strong>Listen for Cues:</strong> When the user interacts with the <code>CommandArea</code> (e.g., clicks the "Connect" button), the <code>CommandArea</code> notifies the <code>Controller</code>.</li>
<li><strong>Direct the Action:</strong> The <code>Controller</code> interprets the cue and tells the <code>Client</code> what to do (e.g., <code>client.connect()</code>).</li>
<li><strong>Handle Incoming Information:</strong> When the <code>Client</code> receives something from the server (like a new message), it gives it to the <code>Controller</code>.</li>
<li><strong>Update the Stage:</strong> The <code>Controller</code> processes the incoming information and makes sure the <code>MessageArea</code> is updated so the user can see it.</li>
</ol>
<p>Without the <code>Controller</code>, the UI and the network logic would be disconnected, unable to work together.</p>
<h2 id="how-the-controller-gets-involved-a-button-click-example">How the Controller Gets Involved: A Button Click Example</h2>
<p>Let's revisit the "Create Topic" button from the <code>CommandArea</code> in <a href="../04_ui_areas__commandarea___messagearea__/">Chapter 4</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// File: src/main/java/no/hvl/dat110/chapp/CommandArea.java (Event Handling part)</span>

<span class="c1">// Inside setupCommandArea, for the &#39;Create Topic&#39; button</span>

<span class="n">createTopicBtn</span><span class="p">.</span><span class="na">setOnAction</span><span class="p">((</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This code runs when createTopicBtn is clicked</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topicField</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span><span class="w"> </span><span class="c1">// Get text from the topic input field</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">topic</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// HERE: CommandArea tells the Controller to do the work!</span>
<span class="w">        </span><span class="n">controller</span><span class="p">.</span><span class="na">createTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Create Topic button clicked for: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">topic</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<ol>
<li>The user types "news" into the <code>topicField</code> and clicks <code>createTopicBtn</code>.</li>
<li>The <code>setOnAction</code> code runs.</li>
<li>It gets the text "news" from <code>topicField</code>.</li>
<li>Crucially, it calls <code>controller.createTopic("news")</code>. The <code>CommandArea</code> delegates the task to the <code>Controller</code>. It doesn't know <em>how</em> to create a topic; it just knows it needs to ask the <code>Controller</code> to do it.</li>
</ol>
<h2 id="what-happens-inside-the-controller">What Happens Inside the Controller?</h2>
<p>So, what does the <code>Controller</code> do when its <code>createTopic("news")</code> method is called?</p>
<ol>
<li><strong>Check Status:</strong> It first checks if the application is actually connected to the server. It doesn't make sense to create a topic if we're not connected!</li>
<li><strong>Delegate to Client:</strong> If connected, it tells the <code>Client</code> object (our network messenger from <a href="../02_client__network_interaction_logic__/">Chapter 2</a>) to handle the request. It calls something like <code>client.createTopic("news")</code>.</li>
<li><strong>Client Does the Work:</strong> The <code>Client</code> then creates the appropriate <code>CreateTopicMsg</code> (from <a href="../01_message_hierarchy__communication_protocol__/">Chapter 1</a>) and sends it over the network to the server.</li>
</ol>
<p>Hereâ€™s a simplified diagram of this flow:</p>
<div class="highlight"><pre><span></span><code>sequenceDiagram
    participant User
    participant CA as CommandArea
    participant Ctrl as Controller
    participant Cl as Client
    participant Srv as Server

    User-&gt;&gt;CA: Clicks &quot;Create Topic&quot; (topic=&quot;news&quot;)
    CA-&gt;&gt;Ctrl: controller.createTopic(&quot;news&quot;)
    Ctrl-&gt;&gt;Ctrl: Check if connected? (Yes)
    Ctrl-&gt;&gt;Cl: client.createTopic(&quot;news&quot;)
    Cl-&gt;&gt;Cl: Create CreateTopicMsg(&quot;news&quot;)
    Cl-&gt;&gt;Srv: Send CreateTopicMsg data
    Note left of Srv: Server processes the request
</code></pre></div>
<h2 id="a-look-at-the-controllers-code">A Look at the Controller's Code</h2>
<p>Let's peek inside <code>Controller.java</code>.</p>
<p><strong>1. Storing Information:</strong> The <code>Controller</code> needs to keep track of important details.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// File: src/main/java/no/hvl/dat110/chapp/Controller.java</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">no.hvl.dat110.client.*</span><span class="p">;</span><span class="w"> </span><span class="c1">// Needed for the Client class</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">no.hvl.dat110.messages.PublishMsg</span><span class="p">;</span><span class="w"> </span><span class="c1">// Needed for receiving messages</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Controller</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Information about the user and server</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">brokerhost</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">brokerport</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// The network messenger</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Flag to track connection status</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isconnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Default values if not set via menus</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;me&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_BROKERHOST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_BROKERPORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8080</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Constructor - Sets default values initially</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Controller</span><span class="w"> </span><span class="p">(</span><span class="n">MessageArea</span><span class="w"> </span><span class="n">messagearea</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">brokerport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_BROKERPORT</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">brokerhost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_BROKERHOST</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_USER</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Note: The messagearea isn&#39;t stored here in this version,</span>
<span class="w">        </span><span class="c1">// but it&#39;s passed to the MessageHandler later.</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ... methods to get/set user, host, port ...</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>It stores the <code>user</code> name, <code>brokerhost</code>, and <code>brokerport</code>. These can be changed via the application menus.</li>
<li>It holds a reference to the <code>Client</code> object (once connected).</li>
<li><code>isconnected</code> is a simple boolean flag to know if we have an active connection.</li>
</ul>
<p><strong>2. Handling the "Connect" Action:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// File: src/main/java/no/hvl/dat110/chapp/Controller.java</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">connect</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assume success initially</span>

<span class="w">        </span><span class="c1">// Create the Client instance with current user/host/port</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Client</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">brokerhost</span><span class="p">,</span><span class="w"> </span><span class="n">brokerport</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Tell the client to establish the network connection</span>
<span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">connect</span><span class="p">();</span><span class="w"> </span><span class="c1">// This internally sends a ConnectMsg</span>

<span class="w">        </span><span class="c1">// In a real app, &#39;connect()&#39; would return true/false</span>
<span class="w">        </span><span class="c1">// based on success. Here we assume it worked.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isconnected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Update our status flag</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ul>
<li>This method is called (likely by the <code>ConnectBtnHandler</code> we saw linked in <code>CommandArea</code>) when the user wants to connect.</li>
<li>It creates a new <code>Client</code> instance using the current settings.</li>
<li>It calls <code>client.connect()</code>, which handles the actual network setup and sends the initial <code>ConnectMsg</code>.</li>
<li>It updates the <code>isconnected</code> flag.</li>
</ul>
<p><strong>3. Handling the "Create Topic" Action:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// File: src/main/java/no/hvl/dat110/chapp/Controller.java</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createTopic</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Only proceed if we are currently connected</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isconnected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Delegate the task to the Client object</span>
<span class="w">            </span><span class="n">client</span><span class="p">.</span><span class="na">createTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ul>
<li>This is the method called by the <code>CommandArea</code>'s button handler.</li>
<li>It first checks the <code>isconnected</code> flag.</li>
<li>If <code>true</code>, it simply calls the corresponding method on the <code>client</code> object: <code>client.createTopic(topic)</code>. The <code>Controller</code> doesn't need to know the details of <em>how</em> the <code>Client</code> does this.</li>
</ul>
<p>Methods like <code>deleteTopic</code>, <code>subscribe</code>, <code>unsubscribe</code>, and <code>publish</code> follow the exact same pattern: check <code>isconnected</code>, then call the corresponding method on the <code>client</code>.</p>
<p><strong>4. Receiving Messages:</strong> How does the <code>Controller</code> get messages <em>from</em> the <code>Client</code> to eventually show in the <code>MessageArea</code>?</p>
<div class="highlight"><pre><span></span><code><span class="c1">// File: src/main/java/no/hvl/dat110/chapp/Controller.java</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">receive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Start with no message</span>

<span class="w">        </span><span class="c1">// Only try to receive if connected</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isconnected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Ask the client to check for incoming messages</span>
<span class="w">            </span><span class="c1">// client.receive() waits for and reconstructs a message</span>
<span class="w">            </span><span class="c1">// We expect PublishMsg specifically for chat content</span>
<span class="w">            </span><span class="n">PublishMsg</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PublishMsg</span><span class="p">)</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">receive</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// If the client actually returned a message (not null)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Format it nicely for display</span>
<span class="w">                </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getUser</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getMessage</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Return the formatted message string, or null if none arrived</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ul>
<li>This <code>receive()</code> method is called periodically by the <code>MessageHandler</code> (which belongs to the <code>MessageArea</code>).</li>
<li>It checks <code>isconnected</code>.</li>
<li>It calls <code>client.receive()</code>. This method in the <code>Client</code> waits for data, reconstructs it into a <code>Message</code> object (using helpers we'll see later), and returns it. We expect incoming chat messages to be <code>PublishMsg</code> type.</li>
<li>If a <code>PublishMsg</code> is received (<code>msg != null</code>), the <code>Controller</code> extracts the user and the actual message content.</li>
<li>It formats this information into a user-friendly string (e.g., <code>[Alice] Hello Bob!</code>).</li>
<li>This string is then returned to the <code>MessageHandler</code>, which appends it to the <code>MessageArea</code>'s <code>TextArea</code>.</li>
</ul>
<h2 id="the-central-hub">The Central Hub</h2>
<p>The <code>Controller</code> truly acts as the central hub or coordinator:</p>
<ul>
<li>It receives requests triggered by user actions in the <code>CommandArea</code>.</li>
<li>It validates these requests (e.g., checking <code>isconnected</code>).</li>
<li>It translates these requests into calls to the <code>Client</code>'s methods.</li>
<li>It receives processed data (incoming messages) from the <code>Client</code>.</li>
<li>It formats this data and makes it available for the <code>MessageArea</code> to display.</li>
</ul>
<p>It ensures that the UI components (<a href="../04_ui_areas__commandarea___messagearea__/">Chapter 4</a>) don't need to know about the complexities of network communication (<a href="../02_client__network_interaction_logic__/">Chapter 2</a>), and the <code>Client</code> doesn't need to know about the specific UI elements like buttons or text areas.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We've learned that the <code>Controller</code> is the essential <strong>UI Logic Coordinator</strong> in our chat application. It acts like a director or a switchboard operator, connecting user interface events to the underlying client logic and relaying incoming information back to the UI for display.</p>
<p>Key takeaways:
*   It decouples the UI (<code>CommandArea</code>, <code>MessageArea</code>) from the network logic (<code>Client</code>).
*   It handles UI events by calling appropriate methods on the <code>Client</code>.
*   It provides a way (<code>receive()</code>) for the UI to get incoming messages processed by the <code>Client</code>.
*   It maintains the application's state, like the connection status (<code>isconnected</code>).</p>
<p>Now that we understand how the UI and the <code>Client</code> interact via the <code>Controller</code>, let's look deeper into how messages are prepared for network transmission. How does our <code>PublishMsg</code> object actually get turned into bytes that can be sent over the internet?</p>
<p>In the next chapter, we'll explore <a href="../06_transportmessage__network_data_framing__/">Chapter 6: TransportMessage (Network Data Framing)</a> to understand how messages are packaged for their journey across the network.</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>